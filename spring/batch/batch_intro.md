<div class="pull-right"> 업데이트 :: 2018.11.01 </div><br>

---

<!-- @import "[TOC]" {cmd="toc" depthFrom=1 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

* [Batch (배치) ?](#batch-배치)
* [Spring Batch ?](#spring-batch)
	* [배치처리 ?](#배치처리)
	* [배치에 적합한 상황 ?](#배치에-적합한-상황)
	* [배치의 요건 ?](#배치의-요건)
	* [배치의 충족요건 ?](#배치의-충족요건)
	* [상주하는 배치 프로세스 ?](#상주하는-배치-프로세스)

<!-- /code_chunk_output -->

### Batch (배치) ?

- 사용자와 무관하게 일정 주기마다 실행되야 하는 배치 애플리케이션

### Spring Batch ?

#### 배치처리 ?

- ==온라인처리== - 사용자의 요청을 받고 필요한 처리를 수행한 다음 실시간으로 응답을 되돌려주는 방식
- ==배치처리== - 일정량의 데이터를 모아서 한번에 처리 & 일정한 순서에 따라 처리
  - 응답성보단 시간당 처리량을 우선시 하는 처리 방식

#### 배치에 적합한 상황 ?

- 상황1. 시간당 처리량을 향상시켜야 하는 경우
  - 데이터를 모아서 한번에 처리하는 방식은 시간당 처리량을 향상시키는 효과를 가짐
  - 파일이나 DB의 입출력을 한 건씩 처리하는 것보다 일정량을 모아서 한번에 처리하는 것이 입출력을 대기하는 오버헤드를 극적으로 줄임
  - 한 건씩 처리할 때 발생하는 입출력 대기 시간 자체는 길지 않으나 대량의 데이터를 하나씩 처리하면 지연을 발생
- 상황2. 온라인 처리의 응답 성능을 개선해야 하는 경우
  - 반드시 온라인으로 처리하지 않아도 되는 부분을 배치 처리 방식으로 전환
  - 접수 처리와 같은 입력은 온라인으로 대응하더라도 내부적으로는 배치로 처리하는 방식이 시스템의 성능을 향상
- 상황3. 비즈니스 업무 특성과 시스템 상의 처리 방식을 일치시켜야 할 경우
  - 일정 시간에 걸쳐서 처리해야하는 경우
  - 한 달 동안 누적된 데이터를 집계해야 하거나 운영 정책에 따라 매주 일정 시간마다 데이터를 백업하는 경우
- 상황4. 외부 시스템과 연계해야 하는 경우
  - 외부 시스템과 상호작용할 경우, 굳이 실시간처리가 필요없는 경우 일정 기간 동안 모인 데이터를 파일 형태로 만드렁 상대 시스템과 교환
  - 파일단위로 처리할때는 온라인처리보다 배치처리가 적합

#### 배치의 요건 ?

- 잡 스케줄러
  - 잡 - 배치처리에서 하나의 실행 단위
  - 잡이 원활하게 실행되기 위해 잡 간의 연관관계를 정의하거나 실행할 스케줄을 관리하는 기능 필요
- 셀 스크립트
  - OS나 미들웨어 등에 구현된 각종 명령을 조합해서 필요한 처리를 수행
  - 파일 복사나 백업, 테이블 초기화 같은 비교적 간단한 처리에는 적합하나 비즈니스 로직을 처리할 만큼 복잡한 잡은 만들기 어려움
  - 셀 스크립트는 프로그래밍 언어로 개발된 애플리케이션을 실행하는 방법으로 잡을 수행할 수도 있음
- 자바와 같은 프로그래밍 언어
  - 셀 스크립트보다 복잡한 처리를 할 수 있고 개발 생산성이나 유지보수성, 개발된 잡 코드에 대한 품질을 일정 수준 유지하는 경우에 적합
  - 비교적 복잡한 비즈니스 로직을 처리한다거나 파일이나 DB데이터 가공 처리 등에 많이 활용

#### 배치의 충족요건 ?

- 대량의 데이터를 제한된 리소스로 효율적으로 처리할 수 있어야 한다.
  - 백만건을 다루든 일억건을 다루든 일정량으로 정해진 CPU와 메모리를 활용해서 처리
  - 그래서 처리할 건수가 늘어날수록 처리하는 시간도 선형적으로 늘어나는 형태가 된다면 나름 이상적 처리를 하는 셈
  - 일정량의 처리 내용을 모아서 처리할 시에는 트랜잭션 처리 역시 일정량 단위로 시작 및 종료할 수 있어야 함
  - 입출력 자체도 줄임과 동시에 사용하는 리소스의 양을 일정하게 유지할 필요가 있음
  - 다 처리하지 못하는 데이터는 하드웨어 수준에서 최대한 성능이 나오도록 처리하는 것이 필요
    - 처리 데이터를 일정 단위의 건수나 그룹으로 분할한 다음 멀티 프로세스, 멀티 스레드 방식으로 다중 처리를 할 수 있게 하거나
    - 입출력 자체를 최대한 줄일 수 있는 하드웨어로 교체를 검토
- 가능한 한 중단된 작업을 다시 계속할 수 있어야 한다.
  - 대량의 데이터를 처리할 시에는 입력 데이터에 오류가 있거나 시스템 자체에 이상이 발생할 때를 대비한 방어대책이 필요
  - 대량의 데이터 처리에서 오류가 발생할 경우 전체를 다시 작업하는데는 시간적 부작용이 있어, 이 부분을 위해 작업을 이어서 처리할 수 있게 만들거나 처리 자체를 다시 처음부터 재처리할 수 있게 만듬
  - 하나의 잡을 정말 간단하게 만들어 본 후에, 재실행을 쉽게 할 수 있게 만드는 것도 중요
- 다양한 실행조건을 지원해야 한다.
  - 시간을 실행조건으로 걸어두거나 온라인이나 외부 시스템과의 연계에 실행 조건을 걸어 두는 등 배치처리는 다양한 실행조건을 지원
    - 특정 시간이 되면 잡 스케줄러가 배치 처리를 위한 프로세스를 기동
    - 처리가 완료된 프로세스를 종료
    - 프로세스는 상주시켜 놓고 수시로 배치 처리를 기동
- 다양한 입출력 인터페이스를 다룰 수 있어야 한다.
  - 다른 온라인 애플리케이션이나 외부 시스템과 연계시에 DB 또는 CSV, XML과 같은 다양한 파일 형식도 지원
  - 다양한 입출력 형식을 다룰 수 있는 구조를 띠고 있다면 배치 처리를 구현하기 더욱 쉽다

#### 상주하는 배치 프로세스 ?

- 온라인 애플리케이션과 연계돼 있어서 상당히 잦은 빈도로 배치 처리를 해야하는 경우
  - 웹 화면에서 특정 업무의 상세 보고서를 출력해야 하는 상황
    - 온라인처리는 사용자의 보고서 출력 요청만 접수
    - 실제 보고서를 생성하기 위한 내부 동작은 배치 처리에 위임해서 처리
  - 다음과 같은 방식은 응답속도면이나 처리성능면까지 모두 잡을 수 있는 방식
- 다음과 같은 방식을 delayed batch, on-line batch 라고 부르기도 함

---

**Created by MoonsCoding**

e-mail :: jm921106@gmail.com
